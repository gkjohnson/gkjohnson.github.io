<dom-module id="skills-element">
    <template>
        <style type="text/css">
            ul {
                margin: 0;
                padding: 0;
            }

            li {
                list-style: none;
                flex: 1;
                text-align: center;
                font-weight: 300;
                font-size: 14px;
                cursor: default;
            }

            [hovered] li:not([active]) {
                opacity: 0.25;
            }

            #ratios {
                height: 4px;
                margin-top: -10px;
                padding-top: 10px;

                transition: height 0.2s ease,padding-top 0.2s ease;
            }

            [hovered] #ratios {
                height: 14px;
                padding-top: 0;
            }

            #ratios li {
                height: 100%;
                margin: 0;
                padding: 0;
                float: left;
                color: transparent;
                text-align: left;
                font-size: 11px;
                transition: color 0.2s ease;
            }

            [hovered] #ratios li {
                color: white;
            }

            #ratios li span {
                display: inline-block;
                padding: 1px;
                padding-left: 5px;
            }

            #dots {
                display: flex;
            }

            #dots li {
                padding-top: 10px;
            }

            .dot {
                display: inline-block;
                border-radius: 10px;
                height: 10px;
                width: 10px;
            }

            [skill="C/C++"]         { background-color: #FFC107; }
            [skill="Python"]        { background-color: #80CBC4; }
            [skill="Javascript"]    { background-color: #03A9F4; }
            [skill="HTML/CSS"]      { background-color: #E91E63; }
            [skill="C#"]            { background-color: #FF6F00; }
            [skill="Prototyping"]   { background-color: #80CBC4; }
            [skill="Research"]      { background-color: #E91E63; }

        </style>

        <div id="container" hovered$="[[hovered]]">
            <ul id="ratios">
                <template is="dom-repeat" items="[[_processSkills(skills)]]">
                    <li
                        on-mouseenter="_skillMouseenterHandler"
                        on-mouseleave="_skillMouseleaveHandler"
                        skill$="[[item.name]]"
                        style$="[[_getWidthStyle(item.weight)]]"
                        active$="[[_equals(hovered, item.name)]]"
                    >
                        <span>[[_toReadablePercentage(item.weight)]]</span>
                    </li>
               </template>
            </ul>

            <ul id="dots">
                <template is="dom-repeat" items="[[_processSkills(skills)]]">
                    <li
                        on-mouseenter="_skillMouseenterHandler"
                        on-mouseleave="_skillMouseleaveHandler"
                        active$="[[_equals(hovered, item.name)]]"
                    >
                        <span class="dot" skill$="[[item.name]]"></span>
                        <span>[[item.name]]</span>
                    </li>
               </template>
            </ul>
        </div>
    </template>
</dom-module>
<script type="text/javascript">
    (function() {
        class SkillsElement extends Polymer.Element {
            static get is() { return 'skills-element' }

            static get properties() {
                return {
                    skills: {
                        type: Object,
                        value: () => { return {} }
                    },

                    hovered: {
                        type: String,
                        value: null
                    }
                }
            }

            /* Utilities */
            _equals(a,b) { return a === b }

            _processSkills(skills) {
                const arr = []
                let tot = 0

                for (let name in skills) tot += skills[name]

                for (let name in skills) {
                    arr.push({
                        name,
                        weight: skills[name] / tot
                    })
                }

                arr.sort((a, b) => {
                    // Sort by weight
                    // const aw = Math.floor(a.weight * 100)
                    // const bw = Math.floor(b.weight * 100)
                    // if (aw > bw) return -1
                    // else if(aw < bw) return 1

                    // Sort by name
                    if (a.name > b.name) return 1
                    else if (a.name < b.name) return -1
                    else return 0
                })

                return arr
            }

            _getWidthStyle(weight) {
                return `width: ${weight*100}%`
            }

            _toReadablePercentage(weight) {
                return Math.floor(weight * 100) + '%'
            }

            /* Event Handlers */
            _skillMouseenterHandler(e) {
                this.hovered = e.model.item.name
            }

            _skillMouseleaveHandler(e) {
                this.hovered = null
            }
        }
        customElements.define(SkillsElement.is, SkillsElement)

    })()
</script>